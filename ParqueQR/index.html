<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Tickets - Parque de Diversiones</title>
  <style>
    #qr-code {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #scanner {
      display: none;
      margin-top: 20px;
      width: 100%;
      max-width: 500px;
    }
  </style>
</head>
<body>
  <h1>Bienvenido al Parque de Diversiones 游꿕</h1>
  <button onclick="generarTicket()">Generar Ticket</button>
  <button onclick="abrirEscaner()">Escanear QR</button>

  <!-- Contenedor para el c칩digo QR -->
  <div id="qr-code"></div>

  <!-- Video para el esc치ner QR -->
  <video id="scanner" autoplay></video>

  <!-- Cargar el script de QR Code Styling desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.3.1/lib/qr-code-styling.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

  <script>
    function generarTicket() {
      // Limpiar el contenedor antes de agregar un nuevo QR
      const qrCodeContainer = document.getElementById("qr-code");
      qrCodeContainer.innerHTML = ""; // Limpiar el contenedor

      // Crear un nuevo c칩digo QR con solo datos b치sicos
      const qrCode = new QRCodeStyling({
        width: 250,
        height: 250,
        type: "svg",
        data: "https://www.wikipedia.org"  // Cambiar por la URL deseada
      });

      // En lugar de qrCode.generate(), usar qrCode.append()
      qrCode.append(qrCodeContainer);
    }

    // Funci칩n para abrir el esc치ner QR usando la c치mara
    function abrirEscaner() {
      const scanner = document.getElementById('scanner');
      scanner.style.display = 'block';

      // Acceder a la c치mara
      navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(function (stream) {
          scanner.srcObject = stream;
          detectarQR(scanner);
        })
        .catch(function (error) {
          alert("No se pudo acceder a la c치mara.");
        });
    }

    // Funci칩n para detectar el c칩digo QR en el video
    function detectarQR(scanner) {
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');

      function captura() {
        canvas.width = scanner.videoWidth;
        canvas.height = scanner.videoHeight;
        context.drawImage(scanner, 0, 0, canvas.width, canvas.height);

        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, canvas.width, canvas.height);

        if (code) {
          alert("춰C칩digo QR detectado! Acceso concedido.");
          scanner.srcObject.getTracks().forEach(track => track.stop());  // Detener la c치mara despu칠s de detectar el QR
          scanner.style.display = 'none';  // Ocultar el esc치ner
          // Aqu칤 podr칤as procesar el c칩digo QR, por ejemplo redirigir a una URL o mostrar m치s informaci칩n.
        } else {
          requestAnimationFrame(captura);
        }
      }

      captura();
    }
  </script>
</body>
</html>
